{{ define "create-modal" }}
  <div id="create-modal" class="modal">
    <div class="modal-content">
      <h2 class="header">Create ketchup</h2>

      <form method="POST" action="/app/ketchups/">
        <input type="hidden" name="method" value="POST">

        <p class="padding no-margin">
          <label for="create-name" class="block">Name:</label>
          <input id="create-name" type="text" name="repository" placeholder="ViBiOh/ketchup" value="{{ .Version }}">
        </p>

        <p class="padding no-margin">
          <label for="create-version" class="block">My version:</label>
          <input id="create-version" type="text" name="version" placeholder="1.0.0">
        </p>

        {{ template "form_buttons" "Create" }}
      </form>
    </div>
  </div>
{{ end }}

{{ define "edit-modal" }}
  <div id="edit-modal-{{ .Repository.ID }}" class="modal">
    <div class="modal-content">
      <h2 class="header">Edit ketchup</h2>

      <p class="no-margin center padding">{{ .Repository.Name }}</p>

      <form method="POST" action="/app/ketchups/{{ .Repository.ID }}">
        <input type="hidden" name="method" value="PUT">

        <p class="padding no-margin">
          <label for="edit-version-{{ .Repository.ID }}" class="block">My version:</label>
          <input id="edit-version-{{ .Repository.ID }}" name="version" type="text" value="{{ .Version }}">
        </p>

        {{ template "form_buttons" "Edit" }}
      </form>
    </div>
  </div>
{{ end }}

{{ define "delete-modal" }}
  <div id="delete-modal-{{ .Repository.ID }}" class="modal">
    <div class="modal-content">
      <h2 class="header">Confirmation</h2>

      <form method="POST" action="/app/ketchups/{{ .Repository.ID }}">
        <input type="hidden" name="method" value="DELETE">

        <p class="padding no-margin center">
          Are you sure you want to delete <strong>{{ .Repository.Name }}</strong>?
        </p>

        {{ template "form_buttons" "Delete" }}
      </form>
    </div>
  </div>
{{ end }}

{{ define "ketchup" }}
  {{ template "header" . }}
  {{ template "message" .Message }}

  {{ template "ketchups" . }}

  {{ template "footer" . }}
{{ end }}

{{ define "ketchups" }}
  <style>
    {{ range .Ketchups }}
      #delete-modal-{{ .Repository.ID }}:target,
      #edit-modal-{{ .Repository.ID }}:target,
    {{ end }}
    #create-modal:target {
      display: flex;
      z-index: 5;
    }

    {{ range .Ketchups }}
      #delete-modal-{{ .Repository.ID }}:target ~ .content,
      #edit-modal-{{ .Repository.ID }}:target ~ .content,
    {{ end }}
    #create-modal:target ~ .content {
      display: flex;
      z-index: 5;
    }

    .ketchups {
      display: grid;
      grid-gap: .5rem;
      grid-template-columns: repeat(auto-fill, minmax(24rem, 1fr));
      margin: .5rem;
    }

    .ketchup {
      border: 1px solid var(--success);
      display: inline-flex;
      flex-direction: column;
      height: 15rem;
    }

    .suggest {
      border-style: dashed;
    }

    .ketchup--outdated {
      border-color: var(--danger);
    }

    .ketchup__version {
      align-items: center;
      display: flex;
      flex: 1 1;
      flex-basis: auto;
      justify-content: center;
    }

    .block {
      display: block;
    }

    .inline {
      display: inline-block;
    }

    .small {
      font-size: 1.6rem;
    }
  </style>

  {{ template "create-modal" }}

  <article class="ketchups">
    {{ range .Ketchups }}
      {{ template "edit-modal" . }}
      {{ template "delete-modal" . }}

      <div class="ketchup center {{ if ne .Version .Repository.Version }}ketchup--outdated{{ end }}">
        <h2 class="header small ellipsis">{{ .Repository.Name }}</h2>

        <div>
          <img class="icon" src="/svg/github?fill=silver" alt="Github icon">
        </div>

        {{ if .Semver }}
          <p class="no-margin padding">
            {{ .Semver }}
          </p>
        {{ end }}

        <div class="ketchup__version">
          <span>
            <a class="{{ if ne .Version .Repository.Version }}danger{{ else }}success{{ end }}" href="https://github.com/{{ .Repository.Name }}/releases/tag/{{ .Version }}">{{ .Version }}</a>
          </span>

          {{ if ne .Version .Repository.Version }}
            <span>
              &nbsp;->&nbsp;<a class="success" href="https://github.com/{{ .Repository.Name }}/releases/tag/{{ .Repository.Version }}">{{ .Repository.Version }}</a>
            </span>
          {{ end }}
        </div>

        <div>
          {{ if ne .Version .Repository.Version }}
            <a href="https://github.com/{{ .Repository.Name }}/compare/{{ .Version }}...{{ .Repository.Version }}" class="button button-icon" title="Compare">
              <img class="icon" src="/svg/eyes?fill=silver" alt="Compare icon">
            </a>

            <form method="POST" action="/app/ketchups/{{ .Repository.ID }}" class="inline">
              <input type="hidden" name="method" value="PUT">
              <input type="hidden" name="version" value="{{ .Repository.Version }}">

              <button type="submit" class="button button-icon" title="Update to latest">
                <img class="icon" src="/svg/circle-up?fill=silver" alt="Update icon">
              </button>
            </form>
          {{ end }}

          <a href="#edit-modal-{{ .Repository.ID }}" class="button button-icon" title="Edit">
            <img class="icon" src="/svg/edit?fill=silver" alt="Edit icon">
          </a>
          <a href="#delete-modal-{{ .Repository.ID }}" class="button button-icon" title="Delete">
            <img class="icon" src="/svg/times?fill=silver" alt="Delete icon">
          </a>
        </div>
      </div>
    {{ end }}

    {{ range .Suggests }}
      <div class="ketchup center suggest">
        <h2 class="header small ellipsis">{{ .Name }}</h2>

        <div class="ketchup__version">
          <span>
            <a href="https://github.com/{{ .Name }}/releases/tag/{{ .Version }}">{{ .Version }}</a>
          </span>
        </div>

        <div>
          <form method="POST" action="/app/ketchups/">
            <input type="hidden" name="method" value="POST">
            <input type="hidden" name="repository" value="{{ .Name }}">
            <input type="hidden" name="version" value="{{ .Version }}">

            <button type="submit" class="button button-icon" title="Add suggestion">
              <img class="icon" src="/svg/add?fill=silver" alt="Add icon">
              Add suggestion
            </a>
          </form>
        </div>
      </div>
    {{ end }}
  </article>
{{ end }}
